<script>

  window.PolymerApigility = window.PolymerApigility || {};

  PolymerApigility.RestResponseBehaviorImp = {

    properties: {
      collection: {
        type: Array,
        readOnly: true,
        notify: true
      },

      entity: {
        type: Object,
        readOnly: true,
        notify: true
      },

      collectionName: {
        type: String
      }
    },

    ready: function () {
      this.ironAjax.addEventListener('response', this.responseHandler.bind(this));
      this.ironAjax.addEventListener('error', this.responseErrorHandler.bind(this));
    },

    /**
     * Success response handler
     *
     * @param e
     */
    responseHandler: function (e) {

      var isEntityRequest = false;
      if (e.detail.response._embedded) {
        this._setCollection(e.detail.response['_embedded'][this.collectionName]);
      } else {
        isEntityRequest = true;
        this._setEntity(e.detail.response);
      }

      switch (this.ironAjax.method.toUpperCase()) {
        case 'POST':
          this.fire('rest-iron-ajax-post-response', {restIronAjax: this, isEntityRequest: isEntityRequest});
          break;
        case 'GET':
          this.fire('rest-iron-ajax-get-response', {restIronAjax: this, isEntityRequest: isEntityRequest});
          break;
        case 'PUT':
          this.fire('rest-iron-ajax-put-response', {restIronAjax: this, isEntityRequest: isEntityRequest});
          break;
        case 'PATCH':
          this.fire('rest-iron-ajax-patch-response', {restIronAjax: this, isEntityRequest: isEntityRequest});
          break;
        case 'DELETE':
          this.fire('rest-iron-ajax-delete-response', {restIronAjax: this, isEntityRequest: isEntityRequest});
          break;
      }
    },

    /**
     * Error response handler
     *
     * @param e
     */
    responseErrorHandler: function (e) {
      this.fire('rest-iron-ajax-error-response', {'ironRequest': e.detail.request});
    }
  };
</script>